<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Michael Mayer">
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>TM1638 Library - Sduino</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="../..">Sduino</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">User Guide <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../..">Introduction</a>
</li>
                                    
<li >
    <a href="../../usage/board-manager-install/">Automatic Installation</a>
</li>
                                    
<li >
    <a href="../../usage/build-ide/">Building with the IDE</a>
</li>
                                    
<li >
    <a href="../../usage/faq/">FAQ/common problems</a>
</li>
                                    
<li >
    <a href="../../usage/why-stm8/">When to use an STM8S - and when not</a>
</li>
                                    
<li >
    <a href="../../usage/interrupts/">Pin change interrupts</a>
</li>
                                    
<li >
    <a href="../../usage/manual-install/">Manual Installation</a>
</li>
                                    
<li >
    <a href="../../usage/build-cli/">Building with a Makefile</a>
</li>
                                    
<li >
    <a href="../../usage/limitations/">Limitations</a>
</li>
                                    
<li >
    <a href="../../usage/status-todo/">Status and todo</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Libraries <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../migration/">API description and migration guidelines</a>
</li>
                                    
<li >
    <a href="../Print/">Print</a>
</li>
                                    
<li >
    <a href="../HardwareSerial/">HardwareSerial</a>
</li>
                                    
<li >
    <a href="../SPI/">SPI</a>
</li>
                                    
<li >
    <a href="../Wire/">Wire</a>
</li>
                                    
<li >
    <a href="../I2C/">I2C</a>
</li>
                                    
<li >
    <a href="../EEPROM/">EEPROM</a>
</li>
                                    
<li >
    <a href="../LiquidCrystal/">LiquidCrystal character LCD library</a>
</li>
                                    
<li >
    <a href="../LiquidCrystal_I2C/">LiquidCrystal_I2C character LCD connected via I2C backpack boards</a>
</li>
                                    
<li >
    <a href="../LiquidCrystal_pcf2119/">LiquidCrystal_pcf2119 character LCD connected via I2C</a>
</li>
                                    
<li >
    <a href="../PCD8544/">PCD8544 libray for Nokia 5110-like graphical LCDs</a>
</li>
                                    
<li >
    <a href="../Mini_SSD1306/">Mini_SSD1306 library for monochrome OLED-displays</a>
</li>
                                    
<li >
    <a href="../Stepper/">Stepper library</a>
</li>
                                    
<li >
    <a href="../Servo/">Servo library</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Hardware <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../hardware/flashtool/">Flash tool</a>
</li>
                                    
<li >
    <a href="../../hardware/stm8blue/">Generic STM8S103F3 breakout board (stm8blue)</a>
</li>
                                    
<li >
    <a href="../../hardware/stm8s003/">Generic STM8S003 support</a>
</li>
                                    
<li >
    <a href="../../hardware/esp14/">ESP14 Wifi board (STM8S003F3P6)</a>
</li>
                                    
<li >
    <a href="../../hardware/w1209-thermostat/">W1209 thermostat board (STM8S003F3P6)</a>
</li>
                                    
<li >
    <a href="../../hardware/stm8sblack/">Generic STM8S105K4 breakout board (stm8sblack)</a>
</li>
                                    
<li >
    <a href="../../hardware/stm8sdiscovery/">STM8S105Discovery evaluation board made by ST (STM8S105C6)</a>
</li>
                                    
<li >
    <a href="https://github.com/roybaer/sduino_uno">sduino Uno (STM8S105K6), inspired by Arduino Uno</a>
</li>
                                    
<li >
    <a href="https://github.com/roybaer/sduino_mb">sduino MB (STM8S208MB), inspired by Arduino Mega</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Developer Guide <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../developer/ide-integration/">IDE integration</a>
</li>
                                    
<li >
    <a href="../../developer/compiling-the-tools/">Compiling the tools</a>
</li>
                                    
<li >
    <a href="../../developer/cross-compile-for-osx/">Cross-compiling the tools for OSX</a>
</li>
                                    
<li >
    <a href="../../developer/update-to-manual/">Update an automatic installation to a manual installation</a>
</li>
                                    
<li >
    <a href="../../developer/macro/">C preprocessor macro magic</a>
</li>
                                    
<li >
    <a href="../../developer/pin_mapping/">Ways to define a pin mapping</a>
</li>
                                    
<li >
    <a href="../../developer/coding-style/">Coding style</a>
</li>
                                    
<li >
    <a href="../../developer/sdcc/">Using the SDCC compiler</a>
</li>
                                    
<li >
    <a href="../../developer/spl/">Using the SPL with SDCC and sduino</a>
</li>
                                    
<li >
    <a href="../../developer/bare-metal-programming/">Bare metal programming on the STM8</a>
</li>
                                    
<li >
    <a href="../../developer/optimizations/">Optimizations</a>
</li>
                                    
<li >
    <a href="../../developer/performance/">Performance comparison and benchmarking</a>
</li>
                                    
<li >
    <a href="../../developer/links/">Links and further reading</a>
</li>
                                </ul>
                            </li>
                            <li >
                                <a href="../../contact/">Contact</a>
                            </li>
                            <li >
                                <a href="../../about/">About</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li>
                                <a href="https://github.com/tenbaht/sduino/edit/master/docs/api/TM1638.md"><i class="fa fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#tm1638-library">TM1638 Library</a></li>
            <li><a href="#api">API</a></li>
            <li><a href="#example">Example</a></li>
            <li><a href="#implementation-details">Implementation details</a></li>
            <li><a href="#possible-impovements">Possible impovements</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="tm1638-library">TM1638 Library</h1>
<p>A family of libraries for driving serial LED modules based on the TM1638 and
TM1640 drivers.</p>
<p>Derived from the <a href="https://github.com/rjbatista/tm1638-library">TM1638
library</a> by Ricardo Batista.
This adoption is based on <a href="https://github.com/rjbatista/tm1638-library/commit/027d41583ba85b00b6aebc17030b1c1607b6c768">commit
027d415</a>.</p>
<h2 id="api">API</h2>
<p>This library is a multi-instance library, it supports an arbitrary number of
displays per sketch. The API syntax is very similar to the original C++ syntax, thanks to some
<a href="../developer/macro">c preprocessor macro magic</a>.</p>
<p>The declaration supports polymorphism, but the 'methods' of the
instantiation don't due to C preprocessor constrains. But the different
function names are still very similar to the C++ versions.</p>
<table>
<thead>
<tr>
<th>Arduino method</th>
<th>sduino function</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>TM1638 module(8,9,10);</code></td>
<td><code>TM1638 (module,8,9,10);</code></td>
</tr>
<tr>
<td><code>TM1638 module(8,9,10,0);</code></td>
<td><code>TM1638 (module,8,9,10,0);</code></td>
</tr>
<tr>
<td><code>TM1638 module(8,9,10,1,5);</code></td>
<td><code>TM1638 (module,8,9,10,1,5);</code></td>
</tr>
<tr>
<td><code>module.setDisplayToHexNumber(n,dots)</code></td>
<td><code>module_setDisplayToHexNumber(n,dots)</code></td>
</tr>
<tr>
<td><code>module.setDisplayToHexNumber(n,dots,font)</code></td>
<td><code>module_setDisplayToHexNumber3(n,dots,font)</code></td>
</tr>
<tr>
<td><code>module.setDisplayToDecNumber(n,dots)</code></td>
<td><code>module_setDisplayToDecNumber(n,dots)</code></td>
</tr>
<tr>
<td><code>module.setDisplayToDecNumber(n,dots,font)</code></td>
<td><code>module_setDisplayToDecNumber3(n,dots,font)</code></td>
</tr>
<tr>
<td><code>module.setDisplayToSignedDecNumber(n,dots)</code></td>
<td><code>module_setDisplayToSignedDecNumber(n,dots)</code></td>
</tr>
<tr>
<td><code>module.setDisplayToSignedDecNumber(n,dots,font)</code></td>
<td><code>module_setDisplayToSignedDecNumber3(n,dots,font)</code></td>
</tr>
<tr>
<td><code>module.setDisplayToBinNumber(n,dots)</code></td>
<td><code>module_setDisplayToBinNumber(n,dots)</code></td>
</tr>
<tr>
<td><code>module.setDisplayToBinNumber(n,dots,font)</code></td>
<td><code>module_setDisplayToBinNumber3(n,dots,font)</code></td>
</tr>
<tr>
<td><code>module.setLED(col,pos)</code></td>
<td><code>module_setLED(col,pos)</code></td>
</tr>
<tr>
<td><code>module.setLEDs(pattern)</code></td>
<td><code>module_setLEDs(pattern)</code></td>
</tr>
<tr>
<td><code>x = module.getButtons()</code></td>
<td><code>x = module_getButtons()</code></td>
</tr>
<tr>
<td><code>module.setupDisplay(act,intens)</code></td>
<td><code>module_setupDisplay(act,intens)</code></td>
</tr>
<tr>
<td><code>module.setDisplayDigit(d,pos,dot)</code></td>
<td><code>module_setDisplayDigit(d,pos,dot)</code></td>
</tr>
<tr>
<td><code>module.setDisplayDigit(d,pos,dot,font)</code></td>
<td><code>module_setDisplayDigit4(d,pos,dot,font)</code></td>
</tr>
<tr>
<td><code>module.setDisplayToError()</code></td>
<td><code>module_setDisplayToError()</code></td>
</tr>
<tr>
<td><code>module.setDisplay(data)</code></td>
<td><code>module_setDisplay(data)</code></td>
</tr>
<tr>
<td><code>module.setDisplay(data,len)</code></td>
<td><code>module_setDisplay2(data,len)</code></td>
</tr>
<tr>
<td><code>module.clearDisplayDigit(pos,dot)</code></td>
<td><code>module_clearDisplayDigit(pos,dot)</code></td>
</tr>
<tr>
<td><code>module.clearDisplay()</code></td>
<td><code>module_clearDisplay()</code></td>
</tr>
<tr>
<td><code>module.setDisplayToString(s)</code></td>
<td><code>module_setDisplayToString(s)</code></td>
</tr>
<tr>
<td><code>module.setDisplayToString(s,dots)</code></td>
<td><code>module_setDisplayToString2(s,dots)</code></td>
</tr>
<tr>
<td><code>module.setDisplayToString(s,dots,pos)</code></td>
<td><code>module_setDisplayToString3(s,dots,pos)</code></td>
</tr>
<tr>
<td><code>module.setDisplayToString(s,dots,pos,font)</code></td>
<td><code>module_setDisplayToString4(s,dots,pos,font)</code></td>
</tr>
</tbody>
</table>
<hr />
<h3 id="api-additions">API additions</h3>
<p>The sduino implementation adds some extra methods to the stock Stepper
library to allow to work arounds some limitations of C code vs. C++:</p>
<table>
<thead>
<tr>
<th>Arduino method</th>
<th>sduino function</th>
</tr>
</thead>
<tbody>
<tr>
<td>done automatically on start up</td>
<td><code>myStepper_activateOutputs();</code></td>
</tr>
<tr>
<td>not impemented</td>
<td><code>myStepper_2phase(steps,pin1,pin2);</code></td>
</tr>
<tr>
<td>not impemented</td>
<td><code>myStepper_4phase(steps,pin1,pin2,pin3,pin4);</code></td>
</tr>
<tr>
<td>not impemented</td>
<td><code>myStepper_5phase(steps,pin1,pin2,pin3,pin4,pin5);</code></td>
</tr>
</tbody>
</table>
<h4 id="initializing-the-output-pins-on-demand">Initializing the output pins on demand</h4>
<p>In real C++ the internal class constructor method initializes the motor pins
to output mode automatically at start up of the programm. In C this doesn't
happen automatically. Most libraries implement a begin() method for exactly
this purpose, but this one does not include an explicit constructor method.</p>
<p>Instead, the output mode is set automatically right before the very first
motor step. This means that the driver pins stay uninitialized and are left
floating from the time of power up until the first step is requested. This
won't be a problem in most cases as most motor drivers are using pull-up or
pull-down resistors to ensure proper signal levels.</p>
<p>If needed, the application could call the added <code>activateOutputs()</code> method
in the setup() function to force an immediate port pin initialization:</p>
<pre><code class="c">setup() {
  myStepper_activateOutputs();    // initializes the motor pins to output mode
}
</code></pre>

<h4 id="assigning-the-pin-connections-at-run-time">Assigning the pin connections at run time</h4>
<p>The way the instantiation macro works requires compile-time constant values
for all parameters (see below in section 'Implementation Details'). In order
to be able to (re-) configure the pin connections at run time this version
of the library implements the functions <code>2phase()</code>, <code>4phase()</code> and
<code>5phase()</code>. These functions act like a constructor and allow for full
re-initialisation of an already existing "object".</p>
<p>If you need to (re-) configure the pin connections at run time (e.g. read it
from a configuration EEPROM first) you can initialize a data structure with
<code>0</code> for the unknown pin numbers and set them later by calling the right
xphase()-function:</p>
<pre><code class="c">Stepper (myStepper,0,0);

setup() {
    ... figure out the pin numbers somehow ...
    myStepper_4phase(stepsPerRev, pin1, pin2, pin3, pin4);
    ...
}

loop () {
    ...
    myStepper_setSpeed(60);
    myStepper_step(100);
    ...
}

</code></pre>

<h4 id="5-phase-support-can-be-deactivated-to-save-code-space">5 phase support can be deactivated to save code space</h4>
<p>5 phase motors are not very common, but supporting them increases the code
size significantly. By defining the compiler flag NO_5PHASE it is possible
to deactivate the support for 5 phase motors. This saves 736 bytes of code
space. Add this line to your Makefile if you don't need 5 phase support:</p>
<pre><code class="make">CFLAGS = -DNO_5PHASE
</code></pre>

<h2 id="example">Example</h2>
<p>Notice the slightly different position of the opening parenthesis at the
"class constructor" 'function' Stepper compared to the C++ instantiation.
(available in the examples folder as <code>stepper_oneRevolution.c</code>)</p>
<p>C-Version for use with sduino:</p>
<pre><code class="c">#include &lt;Arduino.h&gt;
#include &lt;Stepper.h&gt;

// change this to fit the number of steps per revolution for your motor
#define stepsPerRevolution 200

// initialize the stepper library on pins 8 through 11:
Stepper (myStepper,stepsPerRevolution, 8, 9, 10, 11);

void setup() {
  // set the speed at 60 rpm:
  myStepper_setSpeed(60);
}

void loop() {
  // step one revolution  in one direction:
  myStepper_step(stepsPerRevolution);
  delay(500);

  // step one revolution in the other direction:
  myStepper_step(-stepsPerRevolution);
  delay(500);
}
</code></pre>

<p>Original Arduino C++-Sytax:</p>
<pre><code class="c++">#include &lt;Stepper.h&gt;

const int stepsPerRevolution = 200;  // change this to fit the number of steps per revolution
// for your motor

// initialize the stepper library on pins 8 through 11:
Stepper myStepper(stepsPerRevolution, 8, 9, 10, 11);

void setup() {
  // set the speed at 60 rpm:
  myStepper.setSpeed(60);
}

void loop() {
  // step one revolution  in one direction:
  myStepper.step(stepsPerRevolution);
  delay(500);

  // step one revolution in the other direction:
  myStepper.step(-stepsPerRevolution);
  delay(500);
}
</code></pre>

<h2 id="implementation-details">Implementation details</h2>
<p>Technically, each Stepper instance is represented by a file-descriptor-like
structure. This structure is initialized by the instantiation macro
<code>Stepper</code>. This means that all values are required to be constant values,
known at compile time. A <code>const</code> qualifier is not enough for SDCC, it
requires either a <code>#define</code> or an <code>enum</code>:</p>
<pre><code class="c">const int numOfSteps = 1;   // does not work with SDCC
#define MotorPin1  10       // ok, works
enum { MotorPin2 = 11 };    // ok, works

Stepper (myStepper, numOfSteps, MotorPin1, MotorPin2);
</code></pre>

<p>All functions require a pointer to the stepper data structur as their first
argument to identify the stepper instance. All this pointer handling is
hidden by preprocessor magic, but it is still real and pure C. If you
insist, you can still call the 'real' functions yourself (but you gain
nothing, the compiler produces exactly the same output).</p>
<h2 id="possible-impovements">Possible impovements</h2>
<p>This is not a to-do-list, just brainstorming and a collection of random
thoughts.</p>
<p>Nothing yet.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
