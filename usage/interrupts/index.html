<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Michael Mayer">
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Pin change interrupts - Sduino</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="../..">Sduino</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="dropdown active">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">User Guide <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../..">Introduction</a>
</li>
                                    
<li >
    <a href="../board-manager-install/">Automatic Installation</a>
</li>
                                    
<li >
    <a href="../build-ide/">Building with the IDE</a>
</li>
                                    
<li >
    <a href="../faq/">FAQ/common problems</a>
</li>
                                    
<li >
    <a href="../why-stm8/">When to use an STM8S - and when not</a>
</li>
                                    
<li class="active">
    <a href="./">Pin change interrupts</a>
</li>
                                    
<li >
    <a href="../manual-install/">Manual Installation</a>
</li>
                                    
<li >
    <a href="../build-cli/">Building with a Makefile</a>
</li>
                                    
<li >
    <a href="../limitations/">Limitations</a>
</li>
                                    
<li >
    <a href="../status-todo/">Status and todo</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Libraries <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../api/migration/">API description and migration guidelines</a>
</li>
                                    
<li >
    <a href="../../api/Print/">Print</a>
</li>
                                    
<li >
    <a href="../../api/HardwareSerial/">HardwareSerial</a>
</li>
                                    
<li >
    <a href="../../api/SPI/">SPI</a>
</li>
                                    
<li >
    <a href="../../api/Wire/">Wire</a>
</li>
                                    
<li >
    <a href="../../api/I2C/">I2C</a>
</li>
                                    
<li >
    <a href="../../api/EEPROM/">EEPROM</a>
</li>
                                    
<li >
    <a href="../../api/LiquidCrystal/">LiquidCrystal character LCD library</a>
</li>
                                    
<li >
    <a href="../../api/LiquidCrystal_I2C/">LiquidCrystal_I2C character LCD connected via I2C backpack boards</a>
</li>
                                    
<li >
    <a href="../../api/LiquidCrystal_pcf2119/">LiquidCrystal_pcf2119 character LCD connected via I2C</a>
</li>
                                    
<li >
    <a href="../../api/PCD8544/">PCD8544 libray for Nokia 5110-like graphical LCDs</a>
</li>
                                    
<li >
    <a href="../../api/Mini_SSD1306/">Mini_SSD1306 library for monochrome OLED-displays</a>
</li>
                                    
<li >
    <a href="../../api/Stepper/">Stepper library</a>
</li>
                                    
<li >
    <a href="../../api/Servo/">Servo library</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Hardware <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../hardware/flashtool/">Flash tool</a>
</li>
                                    
<li >
    <a href="../../hardware/stm8blue/">Generic STM8S103F3 breakout board (stm8blue)</a>
</li>
                                    
<li >
    <a href="../../hardware/stm8s003/">Generic STM8S003 support</a>
</li>
                                    
<li >
    <a href="../../hardware/esp14/">ESP14 Wifi board (STM8S003F3P6)</a>
</li>
                                    
<li >
    <a href="../../hardware/w1209-thermostat/">W1209 thermostat board (STM8S003F3P6)</a>
</li>
                                    
<li >
    <a href="../../hardware/stm8sblack/">Generic STM8S105K4 breakout board (stm8sblack)</a>
</li>
                                    
<li >
    <a href="../../hardware/stm8sdiscovery/">STM8S105Discovery evaluation board made by ST (STM8S105C6)</a>
</li>
                                    
<li >
    <a href="https://github.com/roybaer/sduino_uno">sduino Uno (STM8S105K6), inspired by Arduino Uno</a>
</li>
                                    
<li >
    <a href="https://github.com/roybaer/sduino_mb">sduino MB (STM8S208MB), inspired by Arduino Mega</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Developer Guide <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../developer/ide-integration/">IDE integration</a>
</li>
                                    
<li >
    <a href="../../developer/compiling-the-tools/">Compiling the tools</a>
</li>
                                    
<li >
    <a href="../../developer/cross-compile-for-osx/">Cross-compiling the tools for OSX</a>
</li>
                                    
<li >
    <a href="../../developer/update-to-manual/">Update an automatic installation to a manual installation</a>
</li>
                                    
<li >
    <a href="../../developer/macro/">C preprocessor macro magic</a>
</li>
                                    
<li >
    <a href="../../developer/pin_mapping/">Ways to define a pin mapping</a>
</li>
                                    
<li >
    <a href="../../developer/coding-style/">Coding style</a>
</li>
                                    
<li >
    <a href="../../developer/sdcc/">Using the SDCC compiler</a>
</li>
                                    
<li >
    <a href="../../developer/spl/">Using the SPL with SDCC and sduino</a>
</li>
                                    
<li >
    <a href="../../developer/bare-metal-programming/">Bare metal programming on the STM8</a>
</li>
                                    
<li >
    <a href="../../developer/optimizations/">Optimizations</a>
</li>
                                    
<li >
    <a href="../../developer/performance/">Performance comparison and benchmarking</a>
</li>
                                    
<li >
    <a href="../../developer/links/">Links and further reading</a>
</li>
                                </ul>
                            </li>
                            <li >
                                <a href="../../contact/">Contact</a>
                            </li>
                            <li >
                                <a href="../../about/">About</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="../why-stm8/">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="../manual-install/">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li>
                                <a href="https://github.com/tenbaht/sduino/edit/master/docs/usage/interrupts.md"><i class="fa fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#pin-change-interrupts">Pin change interrupts</a></li>
            <li><a href="#description">Description</a></li>
            <li><a href="#about-the-interrupt-service-routine">About the Interrupt Service Routine</a></li>
            <li><a href="#syntax">Syntax</a></li>
            <li><a href="#parameters">Parameters</a></li>
            <li><a href="#returns">Returns</a></li>
            <li><a href="#example-code">Example Code</a></li>
            <li><a href="#interrupt-numbers">Interrupt Numbers</a></li>
            <li><a href="#sleep-mode">Sleep mode</a></li>
            <li><a href="#references">References</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="pin-change-interrupts">Pin change interrupts</h1>
<p><code>attachInterrupt()</code> and <code>detachInterrupt()</code> implement the pin change
external interrupts of the STM8.</p>
<p>Pin change interrupts are supported for all pins on ports PA, PB, PC, PD and
PE except for PA0, PA1, PA7 and PD7. The higher ports PF..PJ (high pin count
CPUs only) don't support interrupts.</p>
<p>Pin change interrupt means there is only one common ISR vector for every
port. E.g. pin PB2 and PB3 share a common ISR routine and the ISR has
to figure out which pin triggered the interrupt.</p>
<h2 id="description">Description</h2>
<p>The first parameter to <code>attachInterrupt()</code> and <code>detachInterrupt()</code> is an
interrupt number. For SDuino this number is identical with the pin number,
but for compatibility reasons you should still use
<code>digitalPinToInterrupt(pin)</code> to translate the actual digital pin to the
specific interrupt number. For example, if you connect to pin 3, use
<code>digitalPinToInterrupt(3)</code> as the first parameter to <code>attachInterrupt()</code>.</p>
<h2 id="about-the-interrupt-service-routine">About the Interrupt Service Routine</h2>
<p>The ISR should be as short and fast as possible. Other interrupts are
blocked while the ISR is running. This means <code>millis()</code> will not increment
and <code>delay()</code> can't work. <code>delayMicroseconds()</code> does not use any counter, so
it will work as normal.</p>
<p>Typically global variables are used to pass data between an ISR and the main
program. To make sure variables shared between an ISR and the main program
are updated correctly, declare them as <code>volatile</code>.</p>
<h2 id="syntax">Syntax</h2>
<p><code>attachInterrupt(digitalPinToInterrupt(pin), ISR, mode)</code> (recommended, fully
Arduino compatible)</p>
<p><code>attachInterrupt(interrupt, ISR, mode)</code> (not recommended, only for Arduino
compatibility)</p>
<p><code>attachInterrupt(pin, ISR, mode)</code> (Not recommended, even if this call
matches the actual implementation. Apart from SDuino this syntax only
works on Arduino SAMD Boards, Uno WiFi Rev2, Due, and 101.)</p>
<h2 id="parameters">Parameters</h2>
<p><code>interrupt</code>: For Arduino compatibility only. The interrupt number
definitions are identical with the pin numbers.</p>
<p><code>pin</code>: The Arduino pin number (or a generic pin specifier like <code>PB2</code>)</p>
<p><code>ISR</code>: the ISR to call when the interrupt occurs; this function must take no
parameters and return nothing. This function is sometimes referred to as an
interrupt service routine.</p>
<p><code>mode</code>: defines when the interrupt should be triggered. Four constants are
predefined as valid values:</p>
<ul>
<li><strong>LOW</strong>: Falling edge and low level (Arduino: low level only)</li>
<li><strong>CHANGE</strong>: Rising and falling edge</li>
<li><strong>RISING</strong>: Rising edge</li>
<li><strong>FALLING</strong>: Falling edge</li>
</ul>
<h2 id="returns">Returns</h2>
<p>Nothing</p>
<h2 id="example-code">Example Code</h2>
<pre><code>// the pin where the input button is attached. Change, if needed
#define BUTTON  PA2

// volatile is important, because this variable is modified in IRQ routine
volatile uint8_t flag = 0;


void on_button_pressed(void)
{
    flag = 1;
}


void setup()
{
    pinMode(LED_BUILTIN, OUTPUT);
    digitalWrite(LED_BUILTIN, 1);   // turn off the LED

    pinMode(BUTTON, INPUT_PULLUP);

    attachInterrupt(digitalPinToInterrupt(BUTTON), on_button_pressed, FALLING);
}


void loop()
{
    if (flag) {
        digitalWrite(LED_BUILTIN, 0);
        delay(300);
        digitalWrite(LED_BUILTIN, 1);
        flag = 0;
    }
}
</code></pre>

<h2 id="interrupt-numbers">Interrupt Numbers</h2>
<p>Normally you should use <code>digitalPinToInterrupt(pin)</code>, rather than place an
interrupt/pin number directly into your sketch. For SDuino the interrupt
numbers are identical with the pin numbers and <code>digitalPinToInterrupt(pin)</code>
is just an empty preprecessor macro.</p>
<p>The only thing to loose is some typing efficiency when writing the sketch,
but it preserves some more Arduino compatibility.</p>
<h2 id="sleep-mode">Sleep mode</h2>
<p>If enabled, these interrupts wake the CPU from all sleep modes, including
halt mode.</p>
<h2 id="references">References</h2>
<p>Parts of this text are copied from the <a href="https://www.arduino.cc/reference/en/language/functions/external-interrupts/attachinterrupt/">Arduino
Reference</a></p>
<p>The Arduino Reference text and this text is licensed under a <a href="https://creativecommons.org/licenses/by-sa/3.0/">Creative
Commons Attribution-Share Alike 3.0 License</a>.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
